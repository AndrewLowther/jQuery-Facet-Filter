/*! FacetFilter - version 1.0.5 */
(function($){"use strict";$.facetfilter=function(element,options){var settings,facets,$element,init;settings={filters:null,anti_filters:null,active_filters:{},single_filters:[],exclude_params:[],ajax_url:null,url_options:{},onsuccess:null,oncomplete:null,onerror:null,callback:null,type:"html"},facets=this,facets.version="1.0.5",facets.settings={},$element=$(element),element=element,init=function(){var key,val;facets.settings=$.extend({},settings,options),$element.on("change",facets.settings.filters,facets.select),$element.on("click",facets.settings.anti_filters,facets.deselect);for(key in facets.settings.exclude_params)val=facets.settings.exclude_params[key],facets.addFacet(val.name,val.val)},facets.request=function(type){var key,facet_data;if(!facets.settings.ajax_url)throw Error("You must supply an ajax URL, bailing");type=void 0===type?"GET":type.toUpperCase(),facet_data=facets.settings.active_filters;for(key in facets.settings.url_options)facet_data[key]=facets.settings.url_options[key];$.ajax({url:facets.settings.ajax_url,type:type,data:facet_data,dataType:facets.settings.type,success:void 0!==facets.settings.onsuccess?facets.settings.onsuccess:function(){},complete:void 0!==facets.settings.oncomplete?facets.settings.oncomplete:function(){},error:void 0!==facets.settings.onerror?facets.settings.onerror:function(){}})},facets.addFacet=function(facet,value){facets.settings.active_filters[facet]===void 0&&(null===value&&(value=1),facets.settings.active_filters[facet]={}),facets.isSingleFilter(facet)?facets.settings.active_filters[facet]=value:facets.settings.active_filters[facet][value]=value},facets.removeFacet=function(facet,value){var key,facet_count;void 0!==value?this.isSingleFilter(facet)||void 0===facets.settings.active_filters[facet][value]?this.isSingleFilter(facet)&&facets.settings.active_filters[facet]!==void 0&&delete facets.settings.active_filters[facet]:delete facets.settings.active_filters[facet][value]:facets.settings.active_filters[facet]!==void 0&&delete facets.settings.active_filters[facet],facet_count=0;for(key in facets.settings.active_filters[facet])facet_count++;0===facet_count&&delete facets.settings.active_filters[facet]},facets.select=function(){var facet_name;facet_name=$(this).parent().parent().attr("id"),facets.addFacet(facet_name,$(this).val()),null!==facets.settings.callback&&facets.settings.callback.apply(facets,["addFacet",facet_name,$(this).val()]),facets.request()},facets.deselect=function(){var facet_name;facet_name=$(this).attr("name").replace(/\[(.*)\]/,""),facets.removeFacet(facet_name,$(this).val()),null!==facets.settings.callback&&facets.settings.callback.apply(facets,["removeFacet",facet_name]),facets.request()},facets.serialize=function(obj,prefix){var str,p,k,v;str=[],void 0===obj&&(obj=facets.settings.active_filters);for(p in obj)k=prefix?prefix+"["+p+"]":p,v=obj[p],str.push("object"==typeof v?facets.serialize(v,k):encodeURIComponent(k)+"="+encodeURIComponent(v));return str.join("&")},facets.isSingleFilter=function(filter){return Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!==n&&1/0!=n&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1}),-1!==facets.settings.single_filters.indexOf(filter)?!0:!1},facets.activeFilters=function(){return facets.settings.active_filters},init()},$.fn.facetfilter=function(options){var facetfilter,ident;return ident="facetfilter",this.each(function(){void 0===$(this).data(ident)&&(facetfilter=new $.facetfilter(this,options),$(this).data(ident,facetfilter))})}})(jQuery);